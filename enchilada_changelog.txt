crDroid 10.1

Changes since v10.0 (31 December 2023) release:
- January 2024 Android Security Bulletin (android-14.0.0_r20) merged from upstream AOSP & LineageOS.
- Upstream changes from LineageOS:
  - Rebased on current lineage-21 branches for our devices.
  - Some kernel fixes merged from LineageOS qcom/sdm845 kernel.
- Upstream changes from crDroid ROM sources:
  - At some point in the last month and a half, the booted Updater got hella fast again, yay!
  - More features & optimizations back in since QPR1 merge. I dunno; the devs keep changing things here & there and it keeps working well.
  - Framework-level Hidden & Protected Apps is back & should hide things properly from 3rd-party launchers now too.
  - I got my tweak to force crDroid Home (default launcher) to allow 1 row height regardless of grid size merged, woo! Thanks to Antonio at NeoLauncher (formerly OmegaLauncher) for the patch.
  - Updated PixelPropsUtils spoofing fingerprint. Good luck with that.
- Device-specific:
  - Updated kernel commits from bananafunction.
  - Updated some things in libperfmgr & tweaked our powerhint a little; feels very good for battery life.
  - Finally got /proc/wakelocks (instead of /d/wakeup_sources, which depends on debugfs being enabled & mounted) backported properly; system_server will stop freaking out about not being able to track power usage stats & draining battery in the background now after a few days of uptime (even if it's not writing wtf logs like in Android 13, it was still having fits & wasting power). Thanks to bryanyee33 & BYZYB for original commits!
  - "Fixed" YouTube & Instagram playback for now (ads not auto-continuing to video, video freezing while audio plays) by dropping QCOM hardware-accelerated VP9 decoder from media_codecs. The downside is that now you can't view 4K files directly in YouTube or NewPipe (since they try to use HW decoding, and YouTube sends VP9-coded video stream in webm container at resolutions > 1080p). See Known Issues below.
  - Got rid of "could not match swap behavior" OpenGL logspam.
  - Did the same "cheat & use in-tree QTI thermal HAL copy" trick as in crDroid 9.x to use different SoC sensor that doesn't constantly set a warning flag even when it's well under temp; fixes Google Photos sync failure with device always being too hot.
- "Misc tweaks & bugfixes." :D (fixed a couple sepolicy denials I think)

Known issues:
- Upstream crDroid/LineageOS/Qualcomm/Google issues:
  - Blurs are very resource-intensive, and I can't disable them by default while keeping the capability intact. For best experience & battery life, go to Settings > Display and disable "window-level blurs". If you want it to look pretty without too much lag/stutter, go to Settings > DeviceExtras and turn "AdrenoBoost" all the way up to 3, but be aware this will consume more battery.
  - Google has been on a rampage against custom ROMs and unlocked bootloaders being able to spoof Play Integrity in a meaningful way, and seems to be requiring hardware-backed integrity (which is currently not spoofable) for Pay/Wallet. It has always been a cat & mouse game, and they can change the rules on their end at any time. Currently a new install will show up with "Device Certified" in Play Store, but that might change any time and is not considered a bug.
  - As of Android 13, we're using the source-built AOSP implementations for bluetooth & NFC, since it's not possible to continue with the old prebuilt QTI vendor blobs & implementation. Some things don't work as well; nothing I can do about it.
  - The "QR Code Scanner" lockscreen shortcut option does not get enabled for use until you add the "QR Scanner" QS tile.
  - Wallpapers & Styles can cause a SystemUI crash if you swap clock faces & colors too rapidly, too many times before settling on something. It's a stupid/funny reason, I hope devs can figure out what to DO about it.
- crDroid OP6/6T-specific issues:
  - VP9 video playback has problems in Android 14 on sdm845 devices using the qcom-caf sdm845 media HAL & qualcomm hardware accelerated decoder. Disabling the hardware-accelerated decoder allows apps like YouTube & Instagram that change stream format mid-session to work correctly again, although playback of 1440p & 4K VP9-compressed content now requires software decoding fallback. TL;DR: you might need to use NewPipe to download 4K videos & VLC to play them now. This isn't just our device; anything using sdm845 or sdm710 or older is going to have problems in Android 14 with VP9 video format decoding in hardware, but whether a maintainer chooses to "fix" it by making it fall back to software decoding is going to be device-specific, so I'll put it here (since I did).

Build type: Monthly (-ish)
Device: OnePlus 6 (enchilada)
Device maintainer: Jordan Whiteley (Terminator_J)
Required firmware: OxygenOS 11.1.2.2

====================
     01-17-2024
====================

   * device/lineage/atv
6a2dc82 atv: rro: Allow devices to disable the remote pairing animation

   * frameworks/base
6a352e78da1f PixelPropsUtils: Update spoof fingerprint (#1062)

   * packages/apps/Aperture
4fa3048 Aperture: Update AGP to 8.2.1
4fe3a04 Aperture: Update Gradle to 8.5
93a5d30 Aperture: Fix HDR10+ drawable
20fb43d Aperture: Run `./gradlew app:generateBp`

   * packages/apps/TvSettings
7f7b51291 Add Lineage advanced restart options

====================
     01-16-2024
====================

   * art
030cb78f99 Make classes visibly initialized with `membarrier`.
3a0b46b300 Fix -Wformat warning
524a8d3d29 Remove a warning from redefinition that isn't very useful
692700a53a Rename a couple of methods related to redefinition for readability
88d95f68af Remove an unused jvmti extension and associated code
c38d2c687c Inverse inputs for vaddps if the generated code can be smaller.
936c28066a Weakly cache the artd reference in ART service
24dc506bf9 Suppress -Wshadow warning
a08fa547c0 Change profile inline cache threshold to 4000.
5fbde9b1b5 Make profile inline cache threshold configurable.
fdf509a178 Hide symbols from libart-compiler dependencies
dd9cde13a7 Don't lookup the profiling info in EnqueueOptimizedCompilation.
a17b5202c4 Initialialize jhp's 'enabled_' field
3057a2f5c8 Remove duplicate function for clearing GC stats
b7e5805bd0 EnsureFlipFunctionStarted in RunCheckpoint only if mutator-lock held
351c3e0652 Use acquire/release for mark_stack_mode_
7715651dbc Use release memory-order when going from gray to non-gray state
1e524a9b7d Fix running uffd GC when transitioning to background state
102b1b6ffe Increase buffer count required for mutator thread during compaction
8cc7db46d3 Use from-space reference when visiting last object of a black-page
e1b2065c6a Unregister unused moving space before starting concurrent compaction
77116040b1 Ensure flip function is executed before another thread accesses stack
23d63c2296 Delete all allocators after deleting class loaders
8d1865fabd Reject partially invalid profiles.
7dc1025248 Add bound check for accessing next-page's first object
a8794105f1 Don't update the compiler filter when using a runtime image.
4a711868e9 Prevent repeatedly generating runtime images.
32ffa0d0ce Only use mincore on linux.
07b0ca3a19 Move back to checking if madvise does not return -1.
25c690e091 Fix memory leak in VMRuntime_setDisabledCompatChangesNative.
7b7871fde7 Don't cast null to a type in the verifier.
d0271b17eb Reland "Fix pathological deoptimization case."
bc1df0a9d4 Small cleanup in HLoadClass.
4d0c46295b Only trim JIT metadata if there is no following compilation task.
9eb81eb99c Reland "Use memset/madv_free instead of dontneed in foreground state."
7b3990bbb4 Remove logic of polling liveness of compiled code.
18d72ee117 Fix code for bugprone-argument-comment clang-tidy warning
dabda3d3f2 Make periodic loop optimization safe from overflow
5f41e4a872 Constant fold DivideUnsigned intrinsic
a16a5c537d Constant fold BitCount intrinsic
db276deb17 Increase the hotness lookup threshold.
e37cf89bcb Align induction var range checks and uses
7931cbd631 Improve linear induction var range creation
5932e4088e Add intrinsic support for CompareAndSetReference
b3cd4db545 Allow LSE to remove acquire/release operations
9a9fb4408e Don't use class monitor lock when redefining
211153c1f2 Disable write-barrier elimination pass
5f7e1c8862 Constant fold Reverse/ReverseBytes
235afef99e Constant fold Highest/LowestOneBit
a1a864827a Constant fold NumberOfTrailing/LeadingZeros
90766ed9fd Improve linear loop optimization overflow checks
6e39d96d79 perfetto: Fix null pointer dereference
1f207f33b4 Handle record flag in object-refvisitor.
d5f17b8ab1 Treat all References like normal objects
5dc7efa2a4 Remove dead phis alongside dead instructions in DCE
3e71dfed9f Set did_opt in HDeadCodeElimination::RemoveEmptyIfs
a8adb08e9c Remove empty ifs
d4c39af99c Add a new helper RecomputeDominatorTree
972a380c87 Add optimization to simplify Select+Binary/Unary ops
1461b4aab1 GraphChecker/Arena container cleanups
c2beda0b33 Avoid nullptr deref in profman
0665f2f775 An instruction cannot be found before itself
37fac5a8d4 Avoid extra GetBestInfo call
0230c1dfab Improve code sinking's sorting
0ba1b521cf Check that the header's section's size are consistent
1435baa2c7 Make sure we don't go past the end in CheckIntraDebugInfoItem
022788e0c1 Separate hiddenapi_class_data_item checks in intra and inter
81a5d7e342 Make CheckIntraCodeItem check the CodeItem with its correct size
32ccb7c29c Verifier fix for string data offsets being out of bounds
5d1def44e3 Fix checks in `DexFile::InitializeSectionsFromMapList()`.
612e459337 Use stp/ldp while calling native functions in arm64
a7a57f06a9 build/art: bump stack frame size slightly/safely

   * device/lineage/atv
7b51f5b atv: Move RRO to correct folder name
219a3c1 Add rro to control gms setup wizard options

   * frameworks/base
e8e274109650 Make the icon of SplashScreenView non-focusable

====================
     01-15-2024
====================

   * device/qcom/sepolicy_vndr/sm8450
b6998a9cc sepolicy_vndr: Remove vendor_service.

   * frameworks/av
55c4a307fc SurfaceUtils: ensure lock() grants a valid pointer

   * frameworks/base
a373800e84b5 SystemUI: Increase QS & QQS header Space for A11 QS style [1/2]
93a113eb9cc8 Add slice copy support for socket file type.

   * hardware/qcom-caf/common
86535b8 qcom: Add qcom-caf wlan to soong namespaces

   * hardware/qcom-caf/wlan
21c176b cld80211: Convert makefile to blueprint

   * tools/extract-utils
3b7da6c extract-utils: Disable elf checks by default
88ddd69 extract-utils: Use sub_dir for sh_binary
71a53af extract-utils: Specify arch for binary targets
8c60233 extract_utils: Sort prefix_match() output
8e791d8 extract-utils: Specify filename for sh_binary
563d962 extract-utils: Support rfsa package targets on vendor
94fac09 extract-utils: Enable elf checks on elf targets

   * vendor/addons
becc1187 addons: Increase QS & QQS header Space for A11 QS style [2/2]

====================
     01-14-2024
====================

   * android
a62841b manifest: Track ThemePicker

   * packages/apps/Settings
55a4c842f4 Settings: Don't make app lock settings searchable

   * packages/apps/ThemePicker
adc07cb3 ThemePicker: Fix up overlay color source
9be2a333 ThemePicker: Clear settings on error

   * packages/apps/crDroidSettings
a143fb8 crdroid: Add native monet settings to change theme style

====================
     01-13-2024
====================

   * art
ea942c3600 Fix crash when inlining uncreachable intrinsics
d33caa80ad Move valid intrinsic check to graph checker
e76c971a94 Speed up graph checker by avoiding HInstructionList::Contains calls

   * frameworks/av
86a76a4716 CCodec: Set Pipeline paused timeout to 1000ms
e2d20cbf7d codec2: Change a Info print into Verbose
afa2fe0866 CCodec: Use pipelineRoom only for HW decoder
1e0ab4121d Codec2: queue a empty work to HAL to wake up allocation thread
38762f065c CCodec: Control the inputs to avoid pipeline overflow
2169b1a3a8 codec2: Use numClientBuffers to control the pipeline

   * frameworks/base
f7b025989b79 SystemUI: Animate StatusBarState doze transition using DarkAnimator
3d766435694f Fix sfps arrow color in overlay
0e35eaf1c485 SystemUI: Optimize notificiation expansion animation
a7b67d0020f3 fix pauseImmediately doesn't work when of swiping up to home
167ef7f81218 Fix scrim issues regarding transparency
a274bb229bfc fixup! SystemUI: Implement Split notification shade changes [SQUASH]
22a187ef82e7 IslandView: Ensure global headsup is enabled

   * packages/apps/Settings
7b3824c517 Settings: Import missing Face Unlock animation

====================
     01-12-2024
====================

   * art
c5e0dd3f51 Speed up HInstruction::ReplaceUsesDominatedBy

   * frameworks/base
0e9ff0308a44 NetworkTraffic: Prevent network callback exception on theme change
